<% messages = @room.messages.since(params[:since]) -%>
<% @last_message = @room.message_preceding(messages.first) unless messages.empty? -%>
<%= {
  :messages => render(
    :partial => 'messages/message.html.erb',
    :collection => messages
  ),
  :online_members => render(
    :partial => 'members/member.html.erb',
    :collection => @room.members.online
  )
}.to_json %>